mit_joint_controller:
  joints:
    type: string_array
    description: "Names of the joints to control"

  end_effector_frame:
    type: string
    description: "Name of the end-effector frame for target pose publishing"

  base_frame:
    type: string
    description: "Name of the base frame for target pose publishing"

  control_mode:
    type: string
    default_value: "impedance_posvel"
    description: "Control mode: gravity or impedance_posvel"
    validation:
      one_of<>: [["gravity", "impedance_posvel"]]

  joint_stiffness:
    type: double_array
    default_value: [10.0, 10.0, 10.0, 10.0, 10.0, 10.0, 10.0]
    description: "Per-joint stiffness gains (Nm/rad). Used in impedance control modes."
    validation:
      element_bounds<>: [0.0, 500.0]

  joint_damping:
    type: double_array
    default_value: [-1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0]
    description: "Per-joint damping gains (Nms/rad). If negative, uses critical damping: 2*sqrt(stiffness). Used in impedance control modes."
    validation:
      element_bounds<>: [-1.0, 500.0]

  alpha:
    type: double
    default_value: 5.0
    description: "Velocity gain for computing desired joint velocities from position error in impedance_posvel mode. Higher values make the controller more aggressive."
    validation:
      bounds<>: [0.0, 10.0]

  limit_commands:
    type: bool
    default_value: true
    description: "Whether to clip commands to joint limits"

  joint_limit_buffer:
    type: double
    default_value: 0.05
    description: "Safety buffer (radians) to stay away from joint limits. The usable range will be reduced by this amount on each side."
    validation:
      bounds<>: [0.0, 0.5]

  torque_safety_factor:
    type: double
    default_value: 1.0
    description: "Safety factor for torque limits (0.0-1.0)"
    validation:
      bounds<>: [0.0, 1.0]

  stop_commands:
    type: bool
    default_value: false
    description: "If true, stop sending commands to hardware (for debugging)"

  gravity_scale:
    type: double
    default_value: 1.0
    description: "Scale factor for gravity compensation torques. Use this to tune gravity compensation if URDF masses are not perfectly accurate."
    validation:
      bounds<>: [0.0, 2.0]

  dq_filter_alpha:
    type: double
    default_value: 0.3
    description: "Low-pass filter coefficient for velocity feedback (0.0-1.0). Lower values = more filtering. Set to 1.0 to disable filtering."
    validation:
      bounds<>: [0.0, 1.0]

  max_position_error:
    type: double
    default_value: 0.5
    description: "Maximum allowed position error per joint (radians). Errors larger than this will be clipped to prevent excessive torques."
    validation:
      bounds<>: [0.0, 3.14159]

  max_velocity:
    type: double
    default_value: 2.0
    description: "Maximum allowed velocity goal per joint (rad/s). Used in impedance_posvel mode when computing velocity from position error."
    validation:
      bounds<>: [0.0, 10.0]

  target_smoothing:
    enabled:
      type: bool
      default_value: true
      description: "Enable smooth interpolation when target jumps by a large amount to prevent velocity spikes"
    jump_threshold:
      type: double
      default_value: 0.3
      description: "Target position jump threshold (radians). If any joint target changes by more than this, smoothing is triggered."
      validation:
        bounds<>: [0.0, 3.14159]
    blend_time:
      type: double
      default_value: 0.5
      description: "Time to blend from current target to new target when a large jump is detected (seconds)"
      validation:
        bounds<>: [0.1, 5.0]

  oscillation_detection:
    enabled:
      type: bool
      default_value: false
      description: "Enable oscillation detection and auto-stop"
    window:
      type: int
      default_value: 35
      description: "Number of samples to check for oscillation detection. At 350Hz control rate, 35 samples = 0.1 seconds"
      validation:
        bounds<>: [10, 500]
    frequency:
      type: double
      default_value: 2.0
      description: "Minimum oscillation frequency to detect (Hz)"
      validation:
        bounds<>: [0.5, 20.0]
    min_amplitude:
      type: double
      default_value: 0.05
      description: "Minimum peak-to-peak oscillation amplitude to detect (radians). Filters out small noise oscillations."
      validation:
        bounds<>: [0.0, 1.0]

  log:
    enabled:
      type: bool
      default_value: false
      description: "Enable debug logging"
    use_async_logging:
      type: bool
      default_value: true
      description: "If true, use asynchronous CSV logging in a background thread for better real-time performance. If false, use synchronous logging (may impact control loop timing)."
